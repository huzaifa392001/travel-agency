gsap.registerPlugin(TextPlugin, EasePack, ScrollTrigger);

function calendarSec() {
    let section = document.querySelector('.calender-section');
    let imgWrap = section.querySelector('.revealImg .wrap');
    let img = section.querySelector('.revealImg img');
    let heading = section.querySelector('.calenderHeading');

    let tl = gsap.timeline({
        scrollTrigger: {
            trigger: section,
            start: 'top 50%',
            toggleActions: 'play none none reverse',
        }
    });
    let headingText = heading.innerText;
    heading.innerText = '';

    tl
        .to(imgWrap, {
            autoAlpha: 0,
            duration: 1.25,
            ease: 'Power3.Out',
        })
        .to(img, {
            scale: 1
        }, "<")
        .to(heading, {
            duration: 1,
            text: headingText,
        }, "<=");
}

function headingAnim() {
    let headings = document.querySelectorAll('.heading');
    headings.forEach((heading) => {
        let text = new SplitType(heading, {types: 'chars'})
        let loadertl = gsap.timeline({
            scrollTrigger: {
                trigger: heading,
                start: 'top 80%',
                toggleActions: 'play none none reverse',
            }
        });
        let chars = gsap.utils.toArray(`.heading .char`);
        chars = chars.reverse()
        loadertl
            .to(chars, {
                x: 0,
                duration: 0.25,
                autoAlpha: 1,
                stagger: 0.1,
                rotate: 0,
                scale: 1,
                ease: "circ.out",
            })
    })
}

function smHeadingAnim() {
    document.querySelectorAll('.heading-sm').forEach(function (heading) {
        let text = new SplitType(heading, {types: 'chars'});

        let loadertl = gsap.timeline({
            scrollTrigger: {
                trigger: heading,
                start: 'top 80%',
                toggleActions: 'play none none reverse',
            },
        });

        let chars = heading.querySelectorAll('.char');

        loadertl.to(chars, {
            x: 0,
            autoAlpha: 1,
            duration: 0.1,
            stagger: 0.1,
            ease: "circ.out",
        });
    });
}

function preloader() {
    function machineGun(wordsData) {
        const container = $("#preloader");
        const _sentenceEndExp = /(\.|\?|!)$/g;

        let tl = gsap.timeline({
            defaults: {delay: 2},
            onComplete() {
                removePreloader();
            },
        });

        let wordCount = wordsData.length;
        let time = 0;

        wordsData.forEach((wordData, i) => {
            let isSentenceEnd = _sentenceEndExp.test(wordData.word);
            let element = $(`<span class='${i}'>${wordData.word}</span>`).appendTo(container);
            let duration = wordData.duration;

            gsap.set(element, {autoAlpha: 0, scale: 0, z: 0.01});

            tl.to(element, duration, {scale: 1.2, ease: 'slow(0.25, 0.9)'}, time)
                .to(element, duration, {autoAlpha: 1, ease: 'slow(0.25, 0.9, true)'}, time);

            time += duration - 0.05;

            if (isSentenceEnd) {
                time += 0.6;
            }
        });
    }

    let wordsData = [
        {word: "Awaken To", duration: 0.75},
        {word: "A Different", duration: 0.75},
        {word: "World", duration: 0.75},
        {word: "Company Name", duration: 1.5},
    ];
    let mainHeading = new SplitType('.main-slider h2', {types: 'words'});
    gsap.set(['.main-slider h2 .word', '.main-slider .bg-image'], {
        scale: 1.5,
        autoAlpha: 0
    })
    gsap.set('.cta-booking-section', {
        yPercent: 100
    })
    gsap.set('header', {
        yPercent: -100
    })
    gsap.set('.hero-text .play-btn', {
        autoAlpha: 0
    })
    machineGun(wordsData);

    function removePreloader() {
        let tl = gsap.timeline({defaults: {ease: "power4.out",}});
        tl
            .to('#preloader', {
                y: "-100%",
                duration: 0.6,
            })
            .to('.main-slider .bg-image', {
                scale: 1,
                autoAlpha: 1,
                duration: 0.5,
            }, '<=0.5')
            .to(['.cta-booking-section', 'header'], {
                yPercent: 0,
                duration: 0.5,
            }, '<=0.5')
            .to('.main-slider h2 .word', {
                scale: 1,
                autoAlpha: 1,
                duration: 0.3,
                stagger: 0.2
            })
            .to('.hero-text .play-btn', {
                autoAlpha: 1
            })
    }
}


function lenisSetup() {
    const lenis = new Lenis({
        duration: 1.5,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        smooth: true,
        mouseMultiplier: 1,
    });

    function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
    }

    requestAnimationFrame(raf);

    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            lenis.scrollTo(this.getAttribute("href"));
        });
    });

    lenis.scrollTo("top");
}

function allSlider() {
    var logoSlider = new Swiper(".logoSlider", {
        loop: true,
        autoplay: true,
        slidesPerView: 2,
        // spaceBetween: 5,
        spaceBetween: 0,
        // If we need pagination

        breakpoints: {
            1024: {
                slidesPerView: 5,
            },
            768: {
                slidesPerView: 4,
            },
            640: {
                slidesPerView: 3,
            },
            576: {
                slidesPerView: 2,
            },
            375: {
                slidesPerView: 2,
            },
        },

        // Navigation arrows
        navigation: {
            nextEl: ".next1",
            prevEl: ".prev1",
        }
    });

    var attractionslider = new Swiper(".attractionslider", {
        loop: true,
        slidesPerView: 1,
        // spaceBetween: 5,
        spaceBetween: 10,
        // If we need pagination

        breakpoints: {
            1024: {
                slidesPerView: 4,
                spaceBetween: 30,
            },
            768: {
                slidesPerView: 4,
            },
            640: {
                slidesPerView: 3,
            },
            576: {
                slidesPerView: 2,
            },
            375: {
                slidesPerView: 2,
            },
        },
        pagination: {
            el: '.swiper-pagination',
        },
        // Navigation arrows
        navigation: {
            nextEl: ".next1",
            prevEl: ".prev1",
        },
        scrollbar: {
            el: '.swiper-scrollbar',
        },
    });

    var activitySlider = new Swiper(".activitySlider", {
        loop: true,
        autoplay: true,
        slidesPerView: 1,
        spaceBetween: 5,
        // If we need pagination

        breakpoints: {
            768: {
                slidesPerView: 2.5,
                spaceBetween: 20,
            },
            640: {
                slidesPerView: 2,
                spaceBetween: 10,
            },
            576: {
                slidesPerView: 2,
                spaceBetween: 10,
            },
            375: {
                slidesPerView: 1,
                spaceBetween: 10,
            },
        },

        // Navigation arrows
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        pagination: {
            el: ".swiper-pagination",
            type: 'progressbar'
        },

        // And if we need scrollbar
        scrollbar: {
            el: ".swiper-scrollbar",
        },
    });

    var testimonialSlider = new Swiper(".testimonialSlider", {
        loop: true,
        slidesPerView: 1,
        spaceBetween: 5,
        // If we need pagination

        breakpoints: {
            768: {
                slidesPerView: 2.5,
                spaceBetween: 20,
            },
            640: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            576: {
                slidesPerView: 1.5,
                spaceBetween: 15,
            },
            375: {
                slidesPerView: 1,
                spaceBetween: 10,
            },
        },

        // Navigation arrows
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        pagination: {
            el: ".page",
            type: 'progressbar'
        },

    });

    var topplacesSlider = new Swiper(".topplacesSlider", {
        loop: true,
        slidesPerView: 1,
        spaceBetween: 5,
        loop: true,
        centeredSlides: true,
        autoplay: {
            delay: 2500,
            disableOnInteraction: false,
        },
        breakpoints: {
            1024: {
                slidesPerView: 5.6,
                spaceBetween: 10,
            },
            768: {
                slidesPerView: 3,
                spaceBetween: 25,
            },
            640: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            576: {
                slidesPerView: 2,
                spaceBetween: 15,
            },
            375: {
                slidesPerView: 1.5,
                spaceBetween: 10,
            },
        },

        // Navigation arrows
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
    });

    function change() {
        var offer = document.getElementById('numberSlides');
        offer.innerHTML = (attractionslider.realIndex + 1) + '/' + (attractionslider.slides.length - 0);
    }

    document.getElementById("prev").addEventListener("click", change);
    document.getElementById("next").addEventListener("click", change);
}

$(window).on("load", function () {
    preloader()
});

$(function () {
    lenisSetup();
    AOS.init({
        duration: 1200,
    });
    allSlider();
    $("#slider-range").slider({
        range: true,
        min: 1,
        max: 50,
        values: [10, 15],
        slide: function (event, ui) {
            $("#fromday").html(ui.values[0]);
            $("#today").html(ui.values[1]);
        }
    });
    $("#fromday").html($("#slider-range").slider("values", 0));
    $("#today").html($("#slider-range").slider("values", 1));
    document.querySelector(".menu-btn").addEventListener('click', () => {
        document.querySelector('body').classList.toggle('menu-isopen');
    })
    calendarSec();
    headingAnim();
    smHeadingAnim();
});